###############################
Пошаговое создание новых сайтов
###############################

Чтобы создать и настроить новый сайт в админ-панели, администратору необходимо:

1. Уточнить, имеется ли в разделе :doc:`/bezantrakta/location/admin/city` нужный для этого сайта город:

* Если город был добавлен ранее - идём дальше.
* Если города нет - его нужно создать, первоначально в состоянии "**подготовка**" ("**Скоро открытие**").

2. Создать новый сайт в привязке к его городу в разделе :doc:`/bezantrakta/location/admin/domain` и сделать его на время первоначальной настройки опубликованным.
3. Отредактировать некоторые JSON-настройки сайта.

* Отредактировать метатеги ``domain`` для сайта в целом (``title``, ``description``, ``keywords``), чтобы вместо текстовых включений ``{город}`` в разных падежах ввести название города в нужном падеже.

* В параметре ``telephone`` можно добавить один или несколько контактных телефонных номеров для блока "**Справки и бронирование**".

* В параметре ``social`` при необходимости можно отредактировать любую ссылку на аккааунт в соцсети, если у местного сайта есть какая-то своя группа в соцсетях.

4. Добавить сайт в инструменты для веб-мастеров и подтвердить право на владение сайтом с помощью метатегов (они будут одинаковыми для всех сайтов и создаются заранее в натсройках по умолчанию). На данный момент для этого используются учётные записи ООО "Р-Терминал":

* `Яндекс.Вебмастер <https://webmaster.yandex.ru/sites/>`_ (учётная запись rterm@yandex.ru)

  * **[+]** (Добавить сайт)
  * Адрес сайта: ``ПСЕВДОНИМ_САЙТА.bezantrakta.ru``
  * Подтверждение прав на сайт

    * Метатег
    * "**Проверить**"

* `Google SearchConsole <https://www.google.com/webmasters/tools/home>`_ (учётная запись rterm.vrn@gmail.com)

  * "**Добавить ресурс**"
  * Веб-сайт: ``ПСЕВДОНИМ_САЙТА.bezantrakta.ru``
  * Подтвердите право собственности

    * Альтернативные способы

      * Тег HTML
      * **Подтвердить**

5. Создать для сайта необходимые счётчики для последующего анализа статистики работы сайта маркетологом. В том числе в счётчиках Яндекс.Метрика и Google Analytics необходимо создать **пошаговые цели для отслеживания конверсии** в процессе заказа билетов на сайте. На данный момент для этого используются учётные записи ООО "Р-Терминал":

* `Яндекс.Метрика <https://metrika.yandex.ru/list/>`_ (учётная запись rterm@yandex.ru)

  * "**Добавить счётчик**"
  * Вкладка **Счётчик**

    * Имя сайта: ``Безантракта (НАЗВАНИЕ_ГОРОДА)``
    * Адрес сайта: ``ПСЕВДОНИМ_САЙТА.bezantrakta.ru``
    * ✔ Принимать данные только с указанных адресов
    * Указать **часовой пояс** города, к которому относится сайт
    * ✔ Вебвизор, карта скроллинга, аналитика форм

  * Вкладка **Вебвизор**

    * ✔ Вебвизор 2.0 (код счётчиков уже обновлён для работы с новой версией Вебвизор 2.0)

  * Вкладка **Цели**

    * Добавить цель

      * Название: "**Заказ билетов**"
      * Тип условия: Составная цель

        * Шаг 1: ``1) Выбор билетов``, событие: идентификатор цели ``step1``
        * Шаг 2: ``2) Оформление билетов``, событие: идентификатор цели ``step2``
        * Шаг 3: ``3) Подтверждение оформления``, событие: идентификатор цели ``step3``

  * Вкладка **Фильтры**

    * Добавить фильтр

      * Исключить трафик, IP-адрес, равно ``31.210.209.36`` (офис "Р-Терминал", Квант-Телеком)
      * Исключить трафик, IP-адрес, равно ``88.83.201.253`` (офис "Р-Терминал", Ростелеком)
      * Исключить трафик, IP-адрес, равно ``217.25.225.15`` (офис "Бельканто")
      * Оставить только трафик, URL-страницы, сайт и дополнительные адреса

  * Вкладка **Уведомления**

    * ✔ по электронной почте web@rterm.ru

  * Вкладка **Доступ**

    * Индивидуальный доступ

      * Логин ``belcanto.vrn`` (электронный адрес belcanto.vrn@yandex.ru), редактирование, комментарий "Бельканто"

  * Номер созданного счётчика указать в параметре ``yandex_counter`` в JSON-настройках сайта и сохранить сайт

* `Google Analytics <https://analytics.google.com/analytics/web/>`_ (учётная запись rterm.vrn@gmail.com)

  * "**Администратор**", аккаунт ``belcanto``

    * Ресурс, "**+ Создать ресурс**"

      * Что вы хотите отслеживать?: Веб-сайт
      * Название сайта: ``Безантракта (НАЗВАНИЕ_ГОРОДА)``
      * URL сайта: ``ПСЕВДОНИМ_САЙТА.bezantrakta.ru``
      * Отрасль: Искусство и развлечения
      * Отчётный часовой пояс: Указать **часовой пояс** города, к которому относится сайт
      * "**Получить идентификатор отслеживания**"
      * Номер созданного счётчика (похожий на ``UA-12345678-N``) указать в параметре ``google_counter`` в JSON-настройках сайта и сохранить сайт

    * Ресурс, Настройки ресурса:

      * ✔ Демографические отчёты и отчёты по категориям интересов

    * Представление, Настройки представления:

      * Название представления: ``Безантракта (НАЗВАНИЕ_ГОРОДА)``
      * Валюта: Российский рубль

    * Представление, Цели:

      * Импортировать сохранённый ранее шаблон целей для сайтов Безантракта под названием "**Заказ билетов**" на созданный сайт:

        * либо "**Импортировать из галереи**"

          * текст в поиском поле "*заказ билетов*"
          * ✔ Acquisition
          * "**Импортировать**"

        * либо `открыть готовую ссылку на этот шаблон целей <https://analytics.google.com/analytics/web/template?uid=Vi4RG9SrTe-nMsZX_bP1Dg>`_

        * выбрать из выпадающего списка во всплывающем окне нужный сайт (если он ещё не выбран)
        * "**Создать**"

  .. note:: В одном аккаунте Google Analytics можно создать **не более 50** счётчиков сайтов.

* `UpToLike <http://uptolike.ru/cabinet/dashboard>`_ для кнопок "**Поделиться**" и т.п. (учётная запись social@bezantrakta.ru)

  * "**Создать проект**",

    * "**Поделиться**"

      * Социальные сети

        * ✔ Facebook
        * ✔ вКонтакте
        * ✔ Twitter

      * Мобильный вид

        * Адаптировать для мобильных устройств

          * Настроить социальные сети

            * ✔ Facebook
            * ✔ вКонтакте
            * ✔ Twitter

      * Дополнительные настройки

        * Цитирование

      * Расположение блока

        * В контенте, горизонтально

      * Внешний вид

        * Размер кнопок: средний (второй пункт)
        * Форма: круглая (первый пкнут)

      * "**Сгенерировать код**"
      * Номер созданного счётчика (значение параметра ``data-pid`` в поле "Код для вставки") в параметре ``uptolike_counter`` в JSON-настройках сайта и сохранить сайт

6. Добавить в привязке к сайту необходимые сопутствующие материалы:

* :doc:`/bezantrakta/article/admin/article` - как правило, для нового сайта требуется создать следующие страницы:

  * Покупка билета (псевдоним ``zakaz``) - описание процесса закаа билетов на сайте с указанием использующихся на сайте способов получения и оплаты билетов.

    .. note:: Поскольку содержимое и оформление страницы пока не утверждено, они либо не создаются, либо создаются, но не публикуются на сайте.

  * **Публичная оферта** (псевдоним ``oferta``) - текст договора публичной оферты. Содержимое страницы на разных сайтах одинаковый, кроме картинок с контактным телефоном конкретного сайта.

  * **Реклама** (псевдоним ``reklama``) - информация о форматах рекламных материалов. Содержимое страницы на разных сайтах одинаковый, кроме абсолютных ссылок на текущий сайт.

  * **Контакты** (псевдоним ``kontakty``) - контактная информация. Оформление страницы одинаковое, отдельные блоки и их содержимое меняются в зависимости от сайта.

  Файлы изображений для рекламы загружены на сервер по пути ``/media/global/rklm_new/``.
  Файлы изображений с описанием проезда до касс загружаются на сервер по пути ``/media/ПСЕВДОНИМ_САЙТА/kassy/``.
  Чтобы какая-то группа изображений при клике на любое из них открывалась во всплывающем окне, в ссылку нужно добавить атрибут ``data-lightbox`` с определённым занчением (``kassy``, ``logo_telefon``, ``logo_text``, ``logo_maska``).

    .. attention:: **Банковские реквизиты обязательно указывать как необходимое условие для проведения на сайте онлайн-оплаты**.

  При создании новых HTML-страниц нужно скопировать содержимое соотв. страницы с другого сайта и отредактировать содержимое для нового сайта.

.. only:: dev

  .. todo:: Для оптимизации работы с сайтами возможно сделать перечисленные выше страницы генерируемыми динамически на основе определённых параметров в настройках сайта, подобно файлам для SEO-оптимизации в приложении ``seo``.

* :doc:`/bezantrakta/menu/admin/menu_item`

  Ссылки **на внутренние страницы** сайта должны начинаться и заканчиваться символами ``/`` (прямой слэш или косая черта) в начале и в конце. Ссылки **на внешние сайты** должны быть абсолютными (начинаться с ``http://`` или ``https://`` и заканчиваться символом ``/``).

  ПУнкты меню размещаются в **верхнем** или **нижнем** меню.

  В верхнем меню должны быть размещены следующие пункты меню:

  * **Главная**, ссылка ``/`` (прямой слэш или косая черта)
  * Ссылки на перечисленные выше HTML-страницы (каждая *ссылка должна совпадать с псевдонимом соотв. страницы*):

    * **Публичная оферта**, ссылка ``oferta``
    * **Реклама**, ссылка ``reklama``
    * **Контакты**, ссылка ``kontakty``

  * Также при необходимости можно создать пункты меню для других страниц, которые должны быть доступны пользователю напрямую в меню, например:

    * **НАЗВАНИЕ _ЗАЛА**, ссылка ``/afisha/venue/ПСЕВДОНИМ_ЗАЛА/`` - фильтрация событий по конкретному залу.

  Нижнее меню на данный момент почти не используется, в нём добавлен только ссылка на фотоотчёты в Instagram на главном воронежском сайте.

* :doc:`/bezantrakta/banner/admin/banner_group_item`

  Баннеры размещаются внизу главной страницы сайта в 3-х блоках слева направо:

    * **Мы в сети** - блок баннеров соцсетей.
      * **ВКонтакте**
      * **Facebook**
      * **Twitter**
      * **Instagram**
    * **Наши партнёры** - блок баннеров сайтов-партнёров конкретного сайта в конкретном городе.
      * баннеры конкретных сайтов-партнёров
    * **Способы оплаты** - блок баннеров способов онлайн-оплаты, если она присутствует на сайте.
      * первый баннер - иконка сервиса онлайн-оплаты (например, Сбербанк или СНГБ)
      * следующие 3 баннера - иконки платёжных систем (Visa, MasterCard, Мир)

.. only:: dev

  .. todo:: Вывод блока баннеров "Мы в сети" следует сделать автоматическим из параметра ``social`` в JSON-настройках сайта, чтобы хранить эти данные в одном месте.

7. Настроить email-адрес для почтовых уведомлений о заказах администратору

Администратор сайтов Безантракта должен получать email-уведомления о создаваемых на сайте заказах (уведомление о конкретном заказе приходит и администратору, и покупателю).

.. note:: Уведомления администратору о заказах на сайтах могут формироваться по-разному:

  1. Как правило, они приходят на **отдельный email-адрес**, специально созданный для конкретного сайта (как правило, если этот сайт передан партнёрам на месте по франшизе, чтобы они сами имели доступ к этому email-адресу).

  2. Для новых сайтов в новых городах на данный момент создан **один shared email-адрес**, который собирает в себе уведомления со всех сайтов новых городов (по крайней мере на данный момент, пока на этих сайтах продаются только электронные PDF-билеты в отсутствие местных представителей со своими кассами и проч.). В этом случае в почтовом аккаунте **создаются отдельные папки и настраиваются фильтры для сборки сообщений с каждого отдельного сайта в его отдельную папку**. Если со временем понадобится перевести какой-то из новых сайтов на вариант 1 (с отдельным email-адресом для него), нужно будет создать новый ящик для этого сайта и перенести на него старые уведомления о заказах.

На данный момент электронная почта компании "Бельканто" администрируется компанией "Р-Терминал".

Электронный адреса нужно создавать в домене ``bezantrakta.ru``, как у самого сайта.

Для создания нового отдельного адреса электронной почты для конкретного сайта (вариант 1), нужно:

* Открыть `Управление почтовым сервером <https://mail.rterm.ru/mailadmin/domains.php>`_ "Р-Терминал",
* Открыть "Управление пользователями домена bezantrakta.ru",
* "Добавить пользователя",

  * Электронный адрес: начинается с ``zakaz_``, содержит название/псевдоним сайта в латиннице, заканчивается на ``@bezantrakta.ru``,
  * Пароль: генерируется автоматически,
  * Комментарий: текстовое описание,
  * ✔ Активировать,
  * "Добавить пользователя".

Для редактирования настроек созданного ранее shared-адреса электронной почты (вариант 2), нужно:

* Открыть `Почтовый веб-интерфейс <https://mail.rterm.ru/>`_ "Р-Терминал",
* Войти с логином/паролем email-аккаунта (смотреть в "Управление почтовым сервером"),
* Создать новую папку для сборки писем с конкретного сайта

  * Настройки > Папки > **[ + ]** Новый фильтр,
  * Имя папки: ``Название сайта``,
  * Родительская папка: ``---``,
  * "Сохранить".

* Создать новый фильтр для сборки сообщений перед перемещением в папку

  * Настройки > Фильтры > **[ + ]** Новый фильтр
  * Имя фильтра: ``Название сайта``,
  * Правила фильтра: ✔ соответствует хотя бы одному из правил > Тема содержит: ``Название сайта``,
  * Действия фильтра: переместить сообщения в (папку): ``Название сайта``.
  * "Сохранить".

В любом случае email-адрес для уведомлений администратора вносится в JSON-настройках СПБ в параметре ``order_email``.

.. warning:: Естественно, затем в почтовых клиентах все ящики следует **настраивать строго по протоколу IMAP**, чтобы их сообщения всегда хранились на сервере и не могли потеряться, будучи один раз загруженными в каком-то почтовом клиенте.


8. Удостовериться в наличии на сайте всей необходимой информации.

9. Включить к показу город (если он не был включен ранее) и опубликовать сайт, если его на какое-то время нужно было сделать НЕопубликованныс ранее.
