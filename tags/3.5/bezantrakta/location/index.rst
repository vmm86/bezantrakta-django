География сайтов
================

В этом разделе содержатся сайты Безантракта как таковые и их привязка к разным городам России.

Поскольку в одном городе может быть создано более одного сайта (главный сайт "**Воронеж**" и "**Воронеж (ТОБ)**" в Воронеже), города хранятся в отдельном подразделе. Сначала создаётся новый город, а затем в привязке к нему создаётся новый сайт.

.. toctree::
  :maxdepth: 1
  :caption: География сайтов

  admin/city
  admin/domain

.. only:: dev

  Приложение содержит базовую логику отображения сайтов Безантракта, привязанных к разным городам России.

  На любом сайте отображается:

  * информация, общая для всех сайтов,
  * информация, специфичная для конкретного сайта и привязанная к модели ``Domain`` по внешнему ключу.

  Определение текущего сайта для отображения в нём соответствующей информации происходит в ``CurrentLocationMiddleware``.

  Модели
  ------

  Города
  ^^^^^^
  .. autoclass:: bezantrakta.location.models.City

  Сайты
  ^^^^^
  .. autoclass:: bezantrakta.location.models.Domain

  Middleware
  ----------

  Получение информации о текущем сайте
  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  Поддомен текущего сайта парсится из URL. Затем из кэша сайтов запрашивается и используется в дальнейшем информация о текущем сайте и его городе.

  .. autoclass:: bezantrakta.location.middleware.CurrentLocationMiddleware
