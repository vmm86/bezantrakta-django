#########################
Раздел "География сайтов"
#########################

В этом разделе содержатся сайты Безантракта как таковые и их привязка к разным городам России.

Поскольку в одном городе может функционировать более одного сайта (например, главный сайт "**Воронеж**" и "**Воронеж (ТОБ)**" в Воронеже), города отделены от сайтов и хранятся отдельно. Сначала создаётся новый город, а затем в привязке к нему создаётся новый сайт.

Затем при входе в разделы админ-панели фильтр по городу/сайту в заголовке позволяет фильтровать информацию, принадлежащую конкретному городу/сайту.

.. toctree::
  :maxdepth: 1
  :caption: География сайтов

  admin/city
  admin/domain

.. only:: dev

  Приложение содержит базовую логику отображения сайтов Безантракта, привязанных к разным городам России.

  На любом сайте отображается:

  * информация, общая для всех сайтов,
  * информация, специфичная для конкретного сайта и привязанная к модели ``Domain`` по внешнему ключу.

  Определение текущего сайта для отображения в нём соответствующей информации (как в админ-панели, так и непосредственно на сайте) происходит в ``CurrentLocationMiddleware``.

  **********
  Middleware
  **********

  Получение информации о текущем сайте
  ====================================
  * Поддомен текущего сайта парсится из URL.
  * Затем из кэша сайтов (который создаётся при создании сайта и инвалидируется при изменении его параметров) запрашивается  информация о текущем городе/сайте.
  * Полученная информация помещается в атрибуты ``request`` для дальнейшего использования.

  .. autoclass:: bezantrakta.location.middleware.CurrentLocationMiddleware
